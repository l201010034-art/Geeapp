<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Clim치tico de Campeche</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Leaflet CSS y JS para el mapa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Leaflet.draw para dibujar en el mapa -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <!-- Google Charts para los gr치ficos -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        :root {
            --maroon-color: #800000;
            --header-text-color: #FFFFFF;
            --control-text-color: #000000;
            --lighter-maroon: #a04040;
            --button-yellow: '#f0ad4e';
        }
        body { font-family: 'Inter', sans-serif; }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-left: -20px;
            margin-top: -20px;
            z-index: 1001; /* Encima del overlay */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gray-900 text-white">

    <div id="loading-overlay" class="hidden overlay">
        <div class="loader"></div>
    </div>

    <div class="flex flex-col md:flex-row h-screen">
        <!-- Panel de Control -->
        <div class="w-full md:w-[420px] bg-[#800000] p-4 overflow-y-auto flex flex-col space-y-3">
            <h1 class="text-2xl font-bold text-center">Informe Clim치tico de Campeche</h1>

            <!-- Rango de Fechas -->
            <div>
                <label class="font-bold">1. Rango de Fechas</label>
                <div class="grid grid-cols-2 gap-2 mt-1">
                    <input type="date" id="startDate" value="2023-01-01" class="p-2 rounded bg-[#a04040] text-white border-gray-500">
                    <input type="date" id="endDate" value="2023-12-31" class="p-2 rounded bg-[#a04040] text-white border-gray-500">
                </div>
            </div>

            <!-- Zona de Inter칠s -->
            <div>
                <label class="font-bold">2. Zona de Inter칠s (o dibuja)</label>
                <div id="zonaSelectorPanel" class="p-2 mt-1 rounded bg-[#a04040]">
                    <!-- Checkboxes se generan aqu칤 -->
                </div>
            </div>

            <!-- Variable Clim치tica -->
            <div>
                <label for="variableSelector" class="font-bold">3. Variable Clim치tica</label>
                <select id="variableSelector" class="w-full p-2 mt-1 rounded bg-[#a04040] text-white border-gray-500"></select>
            </div>
            
            <!-- Paneles de An치lisis Espec칤ficos -->
            <div id="precipAnalysisPanel" class="hidden space-y-2 p-2 border border-gray-400 rounded">
                <label class="font-bold">An치lisis de Precipitaci칩n</label>
                <select id="precipAnalysisSelector" class="w-full p-2 rounded bg-[#a04040] text-white">
                    <option value="accumulated">Acumulado</option>
                    <option value="intensity">Intensidad de Lluvia</option>
                    <option value="frequency">Frecuencia de Lluvias Fuertes (>20mm)</option>
                </select>
                <select id="precipAggregationSelector" class="w-full p-2 rounded bg-[#a04040] text-white">
                     <option value="day">Diaria</option>
                     <option value="week" selected>Semanal</option>
                     <option value="month">Mensual</option>
                     <option value="year">Anual</option>
                </select>
                <button id="precipAnalysisButton" class="w-full p-2 font-bold bg-[#f0ad4e] text-black rounded hover:bg-yellow-500">Ejecutar An치lisis</button>
            </div>
            <div id="tempAnalysisPanel" class="hidden space-y-2 p-2 border border-gray-400 rounded">
                <label class="font-bold">An치lisis de Temperatura Extrema</label>
                <select id="tempAnalysisSelector" class="w-full p-2 rounded bg-[#a04040] text-white">
                    <option value="heatwave">Olas de Calor</option>
                    <option value="frost">Heladas</option>
                </select>
                <button id="tempAnalysisButton" class="w-full p-2 font-bold bg-[#f0ad4e] text-black rounded hover:bg-yellow-500">Ejecutar An치lisis</button>
            </div>

            <!-- Tipo de Gr치fico -->
            <div>
                <label for="chartTypeSelector" class="font-bold">4. Tipo de Gr치fico (vars. generales)</label>
                <select id="chartTypeSelector" class="w-full p-2 mt-1 rounded bg-[#a04040] text-white border-gray-500">
                    <option value="LineChart">L칤nea</option>
                    <option value="ColumnChart">Barras</option>
                    <option value="ScatterChart">Dispersi칩n</option>
                    <option value="AreaChart">츼rea</option>
                </select>
            </div>

            <!-- Acciones Generales -->
            <div>
                <label class="font-bold">5. Acciones Generales</label>
                <div class="grid grid-cols-2 gap-2 mt-1">
                    <button id="loadDataButton" class="p-2 font-bold bg-[#a04040] rounded hover:bg-red-800">Cargar Datos</button>
                    <button id="compareButton" class="p-2 font-bold bg-[#a04040] rounded hover:bg-red-800">游늵 Comparar</button>
                </div>
            </div>

            <!-- Productos Espec칤ficos -->
            <div>
                <label class="font-bold">6. Productos Espec칤ficos</label>
                 <select id="spiTimescaleSelector" class="w-full p-2 mt-1 rounded bg-[#a04040] text-white">
                    <option value="3">SPI 3 Meses (sequ칤a a corto plazo)</option>
                    <option value="6">SPI 6 Meses (sequ칤a estacional)</option>
                    <option value="12">SPI 12 Meses (sequ칤a a largo plazo)</option>
                </select>
                <div class="grid grid-cols-2 gap-2 mt-2">
                    <button id="calculateSpiButton" class="p-2 font-bold bg-[#f0ad4e] text-black rounded hover:bg-yellow-500">Calcular SPI</button>
                    <button id="fireRiskButton" class="p-2 font-bold bg-[#c9302c] text-white rounded hover:bg-red-700">游댠 Riesgo de Incendio</button>
                </div>
            </div>
            
            <!-- Herramientas -->
            <div>
                <label class="font-bold">7. Herramientas</label>
                <div class="grid grid-cols-2 gap-2 mt-1">
                     <button id="clearDrawingButton" class="p-2 font-bold bg-[#a04040] rounded hover:bg-red-800">Limpiar Dibujo</button>
                     <button id="resetButton" class="p-2 font-bold bg-[#a04040] rounded hover:bg-red-800">Reiniciar App</button>
                </div>
            </div>
            
            <!-- Resumen y Gr치fico -->
            <div class="flex-grow flex flex-col space-y-3">
                 <div>
                    <label class="font-bold">Resumen Estad칤stico</label>
                    <div id="stats-panel" class="p-3 mt-1 min-h-[100px] text-sm bg-[#a04040] rounded whitespace-pre-wrap">Selecciona opciones y carga datos.</div>
                </div>
                 <div class="flex-grow flex flex-col">
                    <label class="font-bold">Gr치fico de Serie Temporal</label>
                    <div id="chart-panel" class="p-2 mt-1 flex-grow bg-[#a04040] rounded flex items-center justify-center">
                        <span class="text-gray-300">El gr치fico aparecer치 aqu칤</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel del Mapa -->
        <div id="map" class="flex-grow h-1/2 md:h-full"></div>
    </div>

    <script type="module">
        // --- Configuraci칩n Inicial ---
        const varParams = {
            'Temperatura del Aire (춿C)': { min: 20, max: 40, palette: ['blue', 'cyan', 'yellow', 'red'], bandName: 'TAM', unit: '춿C', dataset: 'ERA5' },
            'Humedad Relativa (%)': { min: 50, max: 100, palette: ['lightyellow', 'green', 'darkblue'], bandName: 'HR', unit: '%', dataset: 'ERA5' },
            'Radiaci칩n Solar (W/m)': { min: 0, max: 1000, palette: ['lightgray', 'orange', 'red'], bandName: 'Radiacion_Solar', unit: 'W/m', dataset: 'ERA5' },
            'Velocidad del Viento (m/s)': { min: 0, max: 10, palette: ['white', 'lightblue', 'blue'], bandName: 'wind_speed', unit: 'm/s', dataset: 'ERA5' },
            'Temp. Superficial (LST 춿C)': { min: 20, max: 50, palette: ['navy', 'blue', 'cyan', 'yellow', 'red'], bandName: 'LST', unit: '춿C', dataset: 'MODIS' },
            'Precipitaci칩n Acumulada (mm)': { min: 0, max: 200, palette: ['#ffffcc', '#a1dab4', '#41b6c4', '#225ea8'], bandName: 'Precipitacion', unit: 'mm', dataset: 'CHIRPS' },
            'Evapotranspiraci칩n (mm/8 d칤as)': { min: 0, max: 40, palette: ['#d73027', '#fc8d59', '#fee090', '#e0f3f8', '#91bfdb', '#4575b4'], bandName: 'ET', unit: 'mm/8d', dataset: 'MODIS_ET'},
            'Evapotranspiraci칩n Potencial (mm/8 d칤as)': { min: 0, max: 60, palette: ['#d73027', '#fc8d59', '#fee090', '#e0f3f8', '#91bfdb', '#4575b4'], bandName: 'PET', unit: 'mm/8d', dataset: 'MODIS_ET'},
            'D칤as Grado de Crecimiento (춿C d칤a)': { min: 0, max: 20, palette: ['#edf8b1', '#7fcdbb', '#2c7fb8'], bandName: 'GDD', unit: '춿C d칤a', dataset: 'ERA5_DAILY'}
        };
        const zonas = {
            'Todo el Estado': { geom: [[[-92.32,20.84],[-89.1,20.84],[-89.1,17.8],[-92.32,17.8]]], style: {color: 'white', fillColor: '#FFFFFF22', weight: 2} },
            'Zona 1, Ciudad Campeche': { geom: [[[-90.4531, 19.8993],[-90.4890, 19.8781],[-90.5211, 19.8612],[-90.5290, 19.8671],[-90.5343, 19.8631],[-90.5273, 19.8578],[-90.5366, 19.8549],[-90.5444, 19.8461],[-90.5529, 19.8386],[-90.5613, 19.8334],[-90.5685, 19.8282],[-90.5702, 19.8273],[-90.5712, 19.8277],[-90.5735, 19.8269],[-90.5734, 19.8253],[-90.5792, 19.8218],[-90.5852, 19.8187],[-90.5900, 19.8153],[-90.5929, 19.8183],[-90.5997, 19.8136],[-90.6010, 19.8085],[-90.6102, 19.8018],[-90.6165, 19.7991],[-90.6195, 19.7967],[-90.6261, 19.7939],[-90.6294, 19.7909],[-90.6327, 19.7900],[-90.6333, 19.7847],[-90.6389, 19.7790],[-90.6390, 19.7746],[-90.6349, 19.7724],[-90.6277, 19.7780],[-90.6159, 19.7809],[-90.5992, 19.7835],[-90.5922, 19.7947],[-90.5496, 19.7942],[-90.5422, 19.7914],[-90.5308, 19.7932],[-90.5232, 19.7891],[-90.5167, 19.7923],[-90.5048, 19.7900],[-90.5055, 19.7809],[-90.5039, 19.7776],[-90.5080, 19.7714],[-90.5115, 19.7638],[-90.5099, 19.7598],[-90.5171, 19.7573],[-90.5272, 19.7512],[-90.5223, 19.7435],[-90.5138, 19.7338],[-90.4989, 19.7403],[-90.4857, 19.7552],[-90.4698, 19.7498],[-90.4596, 19.7476],[-90.4611, 19.7558],[-90.4641, 19.7628],[-90.4750, 19.7666],[-90.4820, 19.7835],[-90.4643, 19.7960],[-90.4585, 19.8226],[-90.4556, 19.8433],[-90.4460, 19.8818]]], style: {color: 'blue', fillColor: '#0000FF22', weight: 2} },
            'Zona 2, Lerma': { geom: [[[-90.5920, 19.8193],[-90.5996, 19.8133],[-90.6083, 19.8036],[-90.6327, 19.7897],[-90.6385, 19.7802],[-90.6396, 19.7744],[-90.6351, 19.7716],[-90.6279, 19.7779],[-90.5997, 19.7824],[-90.5924, 19.7946],[-90.5741, 19.7954],[-90.5831, 19.8203]]], style: {color: 'green', fillColor: '#00FF0022', weight: 2} },
            'Zona 3, Chin치': { geom: [[[-90.5045, 19.7762],[-90.5187, 19.7562],[-90.5211, 19.7420],[-90.5021, 19.7384],[-90.4856, 19.7542],[-90.4626, 19.7483],[-90.4602, 19.7518],[-90.4748, 19.7647],[-90.4813, 19.7833],[-90.5046, 19.7901]]], style: {color: 'orange', fillColor: '#FFA50022', weight: 2} },
            'Zona 4, San Fco. Campeche': { geom: [[[-90.5051, 19.7895],[-90.4811, 19.7838],[-90.4643, 19.7964],[-90.4464, 19.8814],[-90.4541, 19.8990],[-90.5210, 19.8621],[-90.5292, 19.8663],[-90.5346, 19.8625],[-90.5332, 19.8567],[-90.5831, 19.8203],[-90.5722, 19.7940],[-90.5495, 19.7938],[-90.5261, 19.7906]]], style: {color: 'purple', fillColor: '#80008022', weight: 2} }
        };

        let map, drawnItems, currentGEELayer;
        const zonaLayers = {};
        const zonaCheckboxes = {};

        // --- Inicializaci칩n de UI y Mapa ---
        document.addEventListener('DOMContentLoaded', () => {
            google.charts.load('current', {'packages':['corechart']});
            initMap();
            populateSelectors();
            setupEventListeners();
            zonaCheckboxes[Object.keys(zonas)[0]].click();
        });

        function initMap() {
            map = L.map('map').setView([19.84, -90.53], 9);
            L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
                maxZoom: 20,
                subdomains:['mt0','mt1','mt2','mt3']
            }).addTo(map);

            drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);

            const drawControl = new L.Control.Draw({
                edit: { featureGroup: drawnItems },
                draw: {
                    polygon: true,
                    polyline: false,
                    rectangle: true,
                    circle: false,
                    marker: false,
                    circlemarker: false
                }
            });
            map.addControl(drawControl);

            map.on(L.Draw.Event.CREATED, (e) => {
                drawnItems.clearLayers();
                drawnItems.addLayer(e.layer);
                clearZoneCheckboxes();
                updateStatsPanel('츼rea dibujada seleccionada. Carga datos para analizar.');
            });
            map.on(L.Draw.Event.EDITED, () => updateStatsPanel('츼rea editada. Vuelve a cargar los datos.'));
        }

        function populateSelectors() {
            const varSelector = document.getElementById('variableSelector');
            Object.keys(varParams).forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                varSelector.appendChild(option);
            });

            const zonaPanel = document.getElementById('zonaSelectorPanel');
            Object.keys(zonas).forEach(name => {
                const id = `check-${name.replace(/\s/g, '')}`;
                const div = document.createElement('div');
                div.innerHTML = `<input type="checkbox" id="${id}" class="mr-2"><label for="${id}">${name}</label>`;
                const checkbox = div.firstChild;
                zonaCheckboxes[name] = checkbox;
                checkbox.addEventListener('change', () => handleZoneSelection(name));
                zonaPanel.appendChild(div);
            });
        }
        
        function handleZoneSelection(selectedName) {
            drawnItems.clearLayers();
            Object.keys(zonaCheckboxes).forEach(name => {
                if (name !== selectedName) zonaCheckboxes[name].checked = false;
                if (zonaLayers[name]) {
                    map.removeLayer(zonaLayers[name]);
                    delete zonaLayers[name];
                }
            });

            if (zonaCheckboxes[selectedName].checked) {
                const zona = zonas[selectedName];
                const layer = L.polygon(L.GeoJSON.coordsToLatLngs(zona.geom[0]), zona.style);
                map.addLayer(layer);
                zonaLayers[selectedName] = layer;
                map.fitBounds(layer.getBounds());
            }
        }

        function clearZoneCheckboxes() {
             Object.values(zonaCheckboxes).forEach(cb => cb.checked = false);
             Object.values(zonaLayers).forEach(layer => map.removeLayer(layer));
        }

        function setupEventListeners() {
            document.getElementById('loadDataButton').addEventListener('click', () => handleAnalysis('general'));
            document.getElementById('compareButton').addEventListener('click', () => handleAnalysis('compare'));
            document.getElementById('precipAnalysisButton').addEventListener('click', () => handleAnalysis('precipitation'));
            document.getElementById('tempAnalysisButton').addEventListener('click', () => handleAnalysis('temperature'));
            document.getElementById('calculateSpiButton').addEventListener('click', () => handleAnalysis('spi'));
            document.getElementById('fireRiskButton').addEventListener('click', () => handleAnalysis('fireRisk'));
            document.getElementById('clearDrawingButton').addEventListener('click', () => {
                drawnItems.clearLayers();
                updateStatsPanel('Dibujos limpiados.');
            });
            document.getElementById('resetButton').addEventListener('click', resetApp);
            document.getElementById('variableSelector').addEventListener('change', toggleAnalysisPanels);
        }

        function toggleAnalysisPanels() {
            const selectedVar = document.getElementById('variableSelector').value;
            document.getElementById('precipAnalysisPanel').classList.toggle('hidden', selectedVar !== 'Precipitaci칩n Acumulada (mm)');
            document.getElementById('tempAnalysisPanel').classList.toggle('hidden', selectedVar !== 'Temperatura del Aire (춿C)');
        }

        function resetApp() {
            drawnItems.clearLayers();
            clearZoneCheckboxes();
            zonaCheckboxes[Object.keys(zonas)[0]].click();
            if (currentGEELayer) map.removeLayer(currentGEELayer);
            updateStatsPanel('Selecciona opciones y carga datos.');
            clearChart();
        }

        // --- L칩gica de An치lisis ---

        async function handleAnalysis(type) {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            if (!startDate || !endDate) {
                updateStatsPanel('Error: Por favor, selecciona un rango de fechas.');
                return;
            }

            const activeROIs = getActiveROIs();
            if (activeROIs.length === 0) {
                updateStatsPanel('Error: Selecciona al menos una zona o dibuja un 치rea.');
                return;
            }
            if (type === 'compare' && activeROIs.length < 2) {
                updateStatsPanel('Error: Para comparar, selecciona al menos dos zonas.');
                return;
            }
            
            clearMapAndChart();
            showLoading(true);

            let action = '';
            let params = {};
            const selectedVar = document.getElementById('variableSelector').value;
            const varInfo = varParams[selectedVar];

            switch(type) {
                case 'general':
                    action = 'getGeneralData';
                    params = { startDate, endDate, roi: activeROIs[0], varInfo };
                    break;
                case 'compare':
                    action = 'getCompareData';
                    params = { startDate, endDate, rois: activeROIs, varInfo };
                    break;
                case 'precipitation':
                    action = 'getPrecipitationData';
                    params = {
                        startDate, endDate,
                        roi: activeROIs[0],
                        analysisType: document.getElementById('precipAnalysisSelector').value,
                        aggregation: document.getElementById('precipAggregationSelector').value,
                    };
                    break;
                case 'temperature':
                     action = 'getTemperatureData';
                     params = {
                        startDate, endDate,
                        roi: activeROIs[0],
                        analysisType: document.getElementById('tempAnalysisSelector').value,
                     };
                    break;
                case 'spi':
                    action = 'getSpiData';
                    params = {
                        startDate, endDate,
                        roi: activeROIs[0],
                        timescale: parseInt(document.getElementById('spiTimescaleSelector').value)
                    };
                    break;
                case 'fireRisk':
                     action = 'getFireRiskData';
                     params = { endDate, roi: activeROIs[0] };
                    break;
            }
            
            try {
                const response = await callGeeApi(action, params);
                if (response.mapId) {
                    addGeeLayer(response.mapId.urlFormat);
                }
                if (response.stats) {
                    updateStatsPanel(response.stats);
                }
                if (response.chartData) {
                    drawChart(response.chartData, response.chartOptions);
                }
            } catch (error) {
                console.error("Error en el an치lisis:", error);
                updateStatsPanel(`Error: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        function getActiveROIs() {
            const rois = [];
            // Primero, las 치reas dibujadas
            if (drawnItems.getLayers().length > 0) {
                 drawnItems.getLayers().forEach((layer, i) => {
                    rois.push({
                        name: `츼rea Dibujada ${i + 1}`,
                        geom: layer.toGeoJSON().geometry
                    });
                });
                return rois;
            }

            // Si no hay dibujos, las zonas seleccionadas
            Object.keys(zonaCheckboxes).forEach(name => {
                if (zonaCheckboxes[name].checked) {
                    rois.push({
                        name: name,
                        geom: { type: 'Polygon', coordinates: zonas[name].geom }
                    });
                }
            });
            return rois;
        }

        // --- Comunicaci칩n con la API ---
        
        async function callGeeApi(action, params) {
            const response = await fetch('/api/gee', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action, params })
            });

            const responseText = await response.text();
            if (!response.ok) {
                 console.error("Respuesta del servidor con error:", responseText);
                 try {
                     const errorJson = JSON.parse(responseText);
                     throw new Error(errorJson.details || `El servidor respondi칩 con un error ${response.status}.`);
                 } catch (e) {
                     throw new Error(`El servidor respondi칩 con un error ${response.status}.`);
                 }
            }
            
            try {
                 return JSON.parse(responseText);
            } catch (e) {
                 console.error("Error al parsear JSON:", e);
                 console.error("Texto recibido del servidor:", responseText);
                 throw new Error(`Respuesta inv치lida del servidor.`);
            }
        }

        // --- Helpers de UI ---

        function showLoading(isLoading) {
            document.getElementById('loading-overlay').classList.toggle('hidden', !isLoading);
        }

        function updateStatsPanel(text) {
            document.getElementById('stats-panel').textContent = text;
        }

        function clearMapAndChart() {
            if (currentGEELayer) map.removeLayer(currentGEELayer);
            clearChart();
        }
        
        function clearChart() {
            const chartPanel = document.getElementById('chart-panel');
            chartPanel.innerHTML = '<span class="text-gray-300">El gr치fico aparecer치 aqu칤</span>';
        }

        function addGeeLayer(url) {
            if (currentGEELayer) map.removeLayer(currentGEELayer);
            currentGEELayer = L.tileLayer(url, {
                attribution: 'Google Earth Engine'
            }).addTo(map);
        }
        
        function drawChart(data, options) {
            const chartPanel = document.getElementById('chart-panel');
            if (!data || data.length < 2) {
                clearChart();
                updateStatsPanel(prev => prev + '\nNo hay datos suficientes para generar el gr치fico.');
                return;
            }

            chartPanel.innerHTML = ''; // Limpiar panel
            const dataTable = google.visualization.arrayToDataTable(data);
            
            const chartType = document.getElementById('chartTypeSelector').value;
            
            let chart;
            switch(chartType) {
                case 'ColumnChart':
                    chart = new google.visualization.ColumnChart(chartPanel);
                    break;
                case 'ScatterChart':
                     chart = new google.visualization.ScatterChart(chartPanel);
                    break;
                case 'AreaChart':
                     chart = new google.visualization.AreaChart(chartPanel);
                    break;
                default:
                     chart = new google.visualization.LineChart(chartPanel);
            }

            const defaultOptions = {
                backgroundColor: '#a04040',
                titleTextStyle: { color: '#FFFFFF' },
                legend: { textStyle: { color: '#FFFFFF' }, position: 'top' },
                hAxis: { textStyle: { color: '#FFFFFF' }, titleTextStyle: { color: '#FFFFFF' } },
                vAxis: { textStyle: { color: '#FFFFFF' }, titleTextStyle: { color: '#FFFFFF' } },
                chartArea: { width: '85%', height: '75%' }
            };

            chart.draw(dataTable, {...defaultOptions, ...options});
        }
    </script>
</body>
</html>

